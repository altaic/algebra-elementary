sudo: true

language: haskell
ghc: 7.10.2

cache:
  directories:
    - $HOME/.stack

env:
  matrix:
    - STACK_YAML=stack.yaml

before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -y cloc
  - sudo apt-get install -y hlint

install:
  - travis_retry wget https://github.com/commercialhaskell/stack/releases/download/v0.1.6.0/stack-0.1.6.0-linux-x86_64.tar.gz
  - tar xzf stack-0.1.6.0-linux-x86_64.tar.gz
  - mv stack-0.1.6.0-linux-x86_64/stack stack
  - chmod +x stack
  - travis_retry ./stack setup
  - travis_retry ./stack install --only-snapshot -j4 --verbosity info

script:
  - cloc .
  - hlint .; echo
  - grep -r --include=\*\.{hs,lhs} FIXME . | wc
  - ./stack haddock
  - ./stack clean
  - ./stack test --coverage
